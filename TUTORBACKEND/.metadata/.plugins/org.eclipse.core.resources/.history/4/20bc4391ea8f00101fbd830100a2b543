import org.springframework.web.server.ResponseStatusException;
import org.springframework.http.HttpStatus;

// Create profile
public TutorProfile createProfile(Long userId, TutorProfile profile) {
    userRepository.findById(userId)
            .orElseThrow(() -> new ResponseStatusException(
                    HttpStatus.NOT_FOUND, "User not found"));

    // If profile already exists â†’ return 409 Conflict
    if (tutorProfileRepository.findByUserId(userId).isPresent()) {
        throw new ResponseStatusException(
                HttpStatus.CONFLICT, "Profile already exists for this user");
    }

    profile.setUserId(userId);
    return tutorProfileRepository.save(profile);
}

// Update existing profile
public TutorProfile updateProfile(Long userId, TutorProfile updatedProfile) {
    TutorProfile existingProfile = tutorProfileRepository.findByUserId(userId)
            .orElseThrow(() -> new ResponseStatusException(
                    HttpStatus.NOT_FOUND, "Profile not found"));

    existingProfile.setSubjects(updatedProfile.getSubjects());
    existingProfile.setExperience(updatedProfile.getExperience());
    existingProfile.setBio(updatedProfile.getBio());
    existingProfile.setHourlyRate(updatedProfile.getHourlyRate());
    existingProfile.setLocation(updatedProfile.getLocation());
    existingProfile.setAvailability(updatedProfile.getAvailability());

    return tutorProfileRepository.save(existingProfile);
}
